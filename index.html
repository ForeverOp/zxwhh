<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mountain FPS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body { margin:0; overflow:hidden; background:#000 }
#hud{
  position:fixed; top:10px; left:10px;
  color:white; font-family:Arial;
}
#cross{
  position:fixed; top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:28px; color:white;
}
</style>
</head>
<body>

<div id="hud">Vida: <span id="hp">100</span></div>
<div id="cross">+</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>

<script>
let scene,camera,renderer;
let bullets=[], enemyBullets=[], enemies=[];
let hp=100;

init();
animate();

function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x87ceeb);

  camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
  camera.position.set(0,3,10);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff,.6));
  let sun=new THREE.DirectionalLight(0xffffff,1);
  sun.position.set(50,100,50);
  scene.add(sun);

  // MONTANHA
  let geo=new THREE.PlaneGeometry(300,300,50,50);
  geo.rotateX(-Math.PI/2);
  geo.attributes.position.array.forEach((v,i)=>{
    if(i%3===1) geo.attributes.position.array[i]=Math.random()*6;
  });
  geo.computeVertexNormals();

  let ground=new THREE.Mesh(
    geo,
    new THREE.MeshStandardMaterial({color:0x228B22})
  );
  scene.add(ground);

  // INIMIGOS
  for(let i=0;i<6;i++) spawnEnemy();

  addEventListener("resize",resize);
  addEventListener("click",shoot);
  addEventListener("mousemove",look);
}

function spawnEnemy(){
  let e=new THREE.Mesh(
    new THREE.BoxGeometry(2,3,2),
    new THREE.MeshStandardMaterial({color:0xff0000})
  );
  e.position.set((Math.random()-0.5)*80,2,(Math.random()-0.5)*80);
  e.cooldown=0;
  scene.add(e);
  enemies.push(e);
}

let yaw=0,pitch=0;
function look(e){
  yaw-=e.movementX*0.002;
  pitch-=e.movementY*0.002;
  pitch=Math.max(-1.5,Math.min(1.5,pitch));
  camera.rotation.set(pitch,yaw,0);
}

function shoot(){
  let b=new THREE.Mesh(
    new THREE.SphereGeometry(.15),
    new THREE.MeshBasicMaterial({color:0xffff00})
  );
  b.position.copy(camera.position);
  b.vel=new THREE.Vector3(-Math.sin(yaw),0,-Math.cos(yaw)).multiplyScalar(1.2);
  scene.add(b);
  bullets.push(b);
}

function enemyShoot(e){
  let b=new THREE.Mesh(
    new THREE.SphereGeometry(.15),
    new THREE.MeshBasicMaterial({color:0xff8800})
  );
  b.position.copy(e.position);
  let dir=camera.position.clone().sub(e.position).normalize();
  b.vel=dir.multiplyScalar(.6);
  scene.add(b);
  enemyBullets.push(b);
}

function animate(){
  requestAnimationFrame(animate);

  bullets.forEach((b,i)=>{
    b.position.add(b.vel);
    enemies.forEach((e,ei)=>{
      if(b.position.distanceTo(e.position)<1.5){
        scene.remove(e); enemies.splice(ei,1);
        scene.remove(b); bullets.splice(i,1);
        spawnEnemy();
      }
    });
  });

  enemyBullets.forEach((b,i)=>{
    b.position.add(b.vel);
    if(b.position.distanceTo(camera.position)<1){
      hp-=5;
      document.getElementById("hp").textContent=hp;
      scene.remove(b); enemyBullets.splice(i,1);
      if(hp<=0) location.reload();
    }
  });

  enemies.forEach(e=>{
    let d=camera.position.distanceTo(e.position);
    if(d<40){
      e.lookAt(camera.position);
      if(e.cooldown<=0){
        enemyShoot(e);
        e.cooldown=60;
      }
    }
    e.cooldown--;
  });

  renderer.render(scene,camera);
}

function resize(){
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
}
</script>
</body>
</html>
